# ESP Web Tools Installation Guide

This directory contains the ESP Web Tools installer for FluidTouch, allowing users to flash firmware directly from their browser.

## How It Works

1. **User visits:** https://jeyeager65.github.io/FluidTouch/
2. **Selects hardware:** Basic or Advance
3. **Clicks "Install FluidTouch"** button
4. **Browser prompts** for serial port access
5. **Firmware flashes** automatically to ESP32-S3

## Files

- `index.html` - Web installer UI (switches between manifests based on hardware selection)
- `manifest_basic.json` - ESP Web Tools manifest for Basic hardware
- `manifest_advance.json` - ESP Web Tools manifest for Advance hardware
- `firmware/` - Binary files (generated by GitHub Actions)
  - `basic/` - CrowPanel 7" Basic (4MB Flash, PWM backlight)
    - `bootloader.bin` - ESP32-S3 bootloader
    - `partitions.bin` - Partition table (4MB)
    - `boot_app0.bin` - Boot application selector
    - `firmware.bin` - Main FluidTouch application
  - `advance/` - CrowPanel 7" Advance (16MB Flash, I2C backlight)
    - `bootloader.bin` - ESP32-S3 bootloader
    - `partitions.bin` - Partition table (16MB)
    - `boot_app0.bin` - Boot application selector
    - `firmware.bin` - Main FluidTouch application

## Hardware Variants

### Elecrow CrowPanel 7" Basic
- **MCU:** ESP32-S3-WROOM-1-N4R8 (4MB Flash + 8MB PSRAM)
- **Display:** 800×480 TN LCD
- **Backlight:** PWM control (GPIO2)
- **Build flag:** `-DHARDWARE_BASIC -DBACKLIGHT_PWM`

### Elecrow CrowPanel 7" Advance  
- **MCU:** ESP32-S3-WROOM-1-N16R8 (16MB Flash + 8MB PSRAM)
- **Display:** 800×480 IPS LCD
- **Backlight:** I2C controller (STC8H1K28 at 0x30)
- **Build flag:** `-DHARDWARE_ADVANCE -DBACKLIGHT_I2C`

## GitHub Pages Setup

### One-Time Configuration

1. **Enable GitHub Pages:**
   - Go to repository Settings → Pages
   - Source: "GitHub Actions"
   - Branch: (automatic via workflow)

2. **Create a Release Tag:**
   ```bash
   git tag -a v1.0.0 -m "Release version 1.0.0"
   git push origin v1.0.0
   ```

3. **GitHub Actions will:**
   - Build firmware with PlatformIO
   - Extract bootloader and partition files
   - Upload firmware artifacts
   - Create GitHub Release with download links
   - Deploy web installer to GitHub Pages

### Updating Firmware

Just create a new tag:
```bash
git tag -a v1.0.1 -m "Release version 1.0.1"
git push origin v1.0.1
```

The workflow automatically:
- Builds firmware for both hardware variants
- Updates manifest_basic.json and manifest_advance.json with new version
- Deploys to GitHub Pages
- Creates release with both binaries

## Browser Requirements

ESP Web Tools requires:
- **Chrome** 89+
- **Edge** 89+
- **Opera** 75+

(Web Serial API support required)

## Local Testing

To test the web installer locally:

```bash
cd web
python -m http.server 8000
```

Visit: http://localhost:8000

**Note:** You'll need to manually copy firmware files to `web/firmware/` for local testing:
```bash
mkdir -p web/firmware
cp .pio/build/elecrow-crowpanel-7-basic/*.bin web/firmware/
```

## Customization

### Updating Version Display

Edit `index.html`:
```html
<p class="version">Version: 0.9.1</p>
```

### Adding New Features

Edit the features list in `index.html`:
```html
<li><strong>New Feature</strong> - Description</li>
```

### Changing Branding

Update colors in the `<style>` section of `index.html`.

## Troubleshooting

### "Firmware files not found"
- Ensure GitHub Actions completed successfully
- Check that `web/firmware/basic/` and `web/firmware/advance/` contain all .bin files
- Verify manifest_basic.json and manifest_advance.json paths match actual files

### "Browser not supported"
- User needs Chrome, Edge, or Opera
- Web Serial API must be enabled
- HTTPS required (GitHub Pages provides this)

### "Serial port access denied"
- User must grant permission when browser prompts
- Some corporate/school networks block Web Serial
- Try different USB port or cable

## Manual Flash Alternative

Users who can't use ESP Web Tools can:

1. Download `firmware.bin` from Releases
2. Use [ESP Web Flasher](https://esp.huhn.me/)
3. Or esptool.py:
   ```bash
   esptool.py --chip esp32s3 --port COM6 write_flash 0x10000 firmware.bin
   ```
