<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FluidTouch Installer</title>
    <script type="module" src="https://unpkg.com/esp-web-tools@10/dist/web/install-button.js?module"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e8e8e8;
            min-height: 100vh;
            padding: 0;
        }

        .page-wrapper {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            width: 100%;
            background: rgba(30, 30, 46, 0.85);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 188, 212, 0.3);
            margin-top: 80px;
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-align: center;
            background: linear-gradient(135deg, #00bcd4, #26c6da);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .subtitle {
            text-align: center;
            font-size: 1.2em;
            color: #c9d1d9;
            margin-bottom: 15px;
        }

        .version-badge {
            text-align: center;
            margin-bottom: 30px;
        }

        .version-badge span {
            display: inline-block;
            background: linear-gradient(135deg, #00bcd4, #26c6da);
            color: #1a1a2e;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }

        /* Hardware Selection */
        .hardware-selection {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 188, 212, 0.3);
        }

        .hardware-selection h2 {
            color: #00bcd4;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .hardware-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .hardware-card {
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .hardware-card:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }

        .hardware-card.selected {
            border-color: #00bcd4;
            background: rgba(0, 188, 212, 0.15);
        }

        .hardware-card h3 {
            color: #e8e8e8;
            font-size: 1.05em;
            margin-bottom: 10px;
        }

        .hardware-badge {
            display: inline-block;
            background: #00bcd4;
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.7em;
            font-weight: 600;
            margin-left: 8px;
        }

        .hardware-specs {
            font-size: 0.85em;
            color: #8b949e;
            line-height: 1.6;
            margin-top: 10px;
        }

        .hardware-specs div {
            margin: 5px 0;
        }

        .spec-highlight {
            color: #00bcd4;
            font-weight: 600;
        }

        .product-link {
            display: block;
            margin-top: 10px;
            color: #00bcd4;
            text-decoration: none;
            font-size: 0.85em;
            transition: color 0.3s ease;
        }

        .product-link:hover {
            color: #26c6da;
            text-decoration: underline;
        }

        /* Features Section */
        .features {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 188, 212, 0.3);
        }

        .features h2 {
            color: #00bcd4;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .features ul {
            list-style: none;
            padding-left: 0;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .features li {
            padding: 12px;
            padding-left: 35px;
            position: relative;
            line-height: 1.5;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border-left: 3px solid #00bcd4;
        }

        .features li:before {
            content: "‚úì";
            position: absolute;
            left: 12px;
            color: #00bcd4;
            font-weight: bold;
            font-size: 1.2em;
        }

        /* Installation Section */
        .install-section {
            text-align: center;
            padding: 35px;
            background: linear-gradient(135deg, rgba(0, 188, 212, 0.15), rgba(38, 198, 218, 0.15));
            border-radius: 15px;
            margin-bottom: 30px;
            border: 2px solid rgba(0, 188, 212, 0.4);
        }

        .install-section h2 {
            color: #00bcd4;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .hardware-confirm {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.95em;
        }

        .hardware-confirm strong {
            color: #00bcd4;
        }

        esp-web-install-button {
            display: inline-block;
        }

        esp-web-install-button button {
            background: linear-gradient(135deg, #00bcd4, #26c6da);
            color: white;
            border: none;
            padding: 18px 45px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        esp-web-install-button button:hover {
            transform: translateY(-2px);
        }

        /* Progress Bar */
        .progress-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            display: none;
        }

        .progress-container.active {
            display: block;
        }

        .progress-step {
            display: flex;
            align-items: center;
            margin: 10px 0;
            font-size: 0.9em;
        }

        .progress-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 0.8em;
        }

        .progress-icon.active {
            background: #00bcd4;
            animation: spin 1s linear infinite;
        }

        .progress-icon.complete {
            background: #00bcd4;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-top: 15px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #00bcd4, #26c6da);
            width: 0%;
            transition: width 0.3s ease;
        }

        /* Requirements */
        .requirements {
            background: rgba(244, 67, 54, 0.1);
            border-left: 4px solid #f44336;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .requirements h3 {
            color: #f44336;
            margin-bottom: 15px;
        }

        .requirements ul {
            list-style: none;
            padding-left: 20px;
        }

        .requirements li {
            margin: 10px 0;
            line-height: 1.6;
        }

        /* Changelog */
        .changelog {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 188, 212, 0.3);
        }

        .changelog h3 {
            color: #00bcd4;
            margin-bottom: 15px;
        }

        .changelog-content {
            display: block;
        }

        .changelog-version {
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border-left: 3px solid #00bcd4;
        }

        .changelog-version h4 {
            color: #e8e8e8;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .changelog-date {
            font-size: 0.85em;
            color: #8b949e;
            margin-bottom: 10px;
        }

        .changelog-items {
            font-size: 0.9em;
            line-height: 1.6;
            color: #c9d1d9;
            list-style: none;
            padding-left: 0;
        }

        .changelog-items li {
            margin: 5px 0;
            padding-left: 20px;
            position: relative;
        }

        .changelog-items li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 5px;
            color: #00bcd4;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .container {
                padding: 25px;
            }
        }

        /* Top Links */
        .top-links {
            width: 100%;
            text-align: center;
            padding: 15px 20px;
            background: #1a1a2e;
            border-bottom: 1px solid rgba(0, 188, 212, 0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
        }

        .top-links a {
            color: #00bcd4;
            text-decoration: none;
            padding: 8px 16px;
            background: rgba(0, 188, 212, 0.1);
            border: 1px solid rgba(0, 188, 212, 0.3);
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.95em;
            white-space: nowrap;
        }

        .top-links a:hover {
            color: #26c6da;
            background: rgba(0, 188, 212, 0.2);
            border-color: rgba(0, 188, 212, 0.5);
            transform: translateY(-2px);
        }

        /* Links */
        .links {
            text-align: center;
            margin-top: 30px;
            padding: 25px;
            border-top: 2px solid rgba(0, 188, 212, 0.3);
            background: rgba(0, 188, 212, 0.05);
            border-radius: 10px;
        }

        .links a {
            display: inline-block;
            color: #00bcd4;
            text-decoration: none;
            margin: 10px 15px;
            padding: 10px 20px;
            background: rgba(0, 188, 212, 0.1);
            border: 1px solid rgba(0, 188, 212, 0.3);
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 1em;
        }

        .links a:hover {
            color: #26c6da;
            background: rgba(0, 188, 212, 0.2);
            border-color: rgba(0, 188, 212, 0.5);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Top Links -->
    <div class="top-links">
        <a href="https://github.com/jeyeager65/FluidTouch" target="_blank">üì¶ GitHub Repository</a>
        <a href="https://github.com/jeyeager65/FluidTouch/issues" target="_blank">üêõ Report Issue</a>
        <a href="https://github.com/jeyeager65/FluidTouch/blob/main/README.md" target="_blank">üìñ Documentation</a>
    </div>

    <div class="page-wrapper">
        <div class="container">
        <div style="text-align: center; margin-bottom: 10px;">
            <h1 style="margin-bottom: 5px;">FluidTouch</h1>
            <div style="width: 300px; height: 2px; background: linear-gradient(90deg, transparent, #00bcd4, transparent); margin: 0 auto;"></div>
        </div>
        <p style="text-align: center; font-size: 1.5em; color: #008fa1; font-weight: 600; margin: 5px 0 25px 0; letter-spacing: 0.02em;">
            Web Installer
        </p>
        <div class="version-badge">
            <span>Version 0.9.6</span>
        </div>
        <p style="text-align: center; font-size: 1.2em; color: #c9d1d9; margin-bottom: 30px;">
            ESP32 Touchscreen CNC Controller for FluidNC
        </p>

        <!-- Changelog -->
        <div class="changelog">
            <h3>üìã What's New in Version 0.9.6</h3>
            <div class="changelog-content">
                <div class="changelog-version">
                    <div class="changelog-date">November 2025</div>
                    <ul class="changelog-items">
                        <li><strong>Settings Backup & Restore:</strong> Export settings to JSON file, auto-import on fresh install, Clear All Settings with confirmation</li>
                        <li><strong>SD Card File Management:</strong> More robust SD card checking</li>
                        <li><strong>File Browser:</strong> Auto-switch to Status tab when running a file</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Hardware Selection -->
        <div class="hardware-selection">
            <h2>üîß Select Your Hardware</h2>
            <div class="hardware-cards">
                <div class="hardware-card selected" data-hardware="basic" onclick="selectHardware('basic')">
                    <h3>Elecrow CrowPanel 7" Basic <span class="hardware-badge">Most Common</span></h3>
                    <div class="hardware-specs">
                        <div><span class="spec-highlight">4MB</span> Flash Memory</div>
                        <div><span class="spec-highlight">8MB</span> PSRAM</div>
                        <div>ESP32-S3-WROOM-1-N4R8</div>
                        <div>Display: 800√ó480 <span class="spec-highlight">TN LCD</span></div>
                    </div>
                    <a href="https://www.elecrow.com/esp32-display-7-inch-hmi-display-rgb-tft-lcd-touch-screen-support-lvgl.html" 
                       target="_blank" class="product-link">View Product Page ‚Üí</a>
                </div>
                <div class="hardware-card" data-hardware="advance" onclick="selectHardware('advance')">
                    <h3>Elecrow CrowPanel 7" Advance</h3>
                    <div class="hardware-specs">
                        <div><span class="spec-highlight">16MB</span> Flash Memory</div>
                        <div><span class="spec-highlight">8MB</span> PSRAM</div>
                        <div>ESP32-S3-WROOM-1-N16R8</div>
                        <div>Display: 800√ó480 <span class="spec-highlight">IPS LCD</span></div>
                        <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1);">
                            <div style="color: #ffa726; font-weight: 600;">‚ö†Ô∏è Hardware Version 1.3 Only</div>
                            <div style="font-size: 0.8em; margin-top: 5px;">DIP switches S0 and S1 ‚Üí position 1</div>
                            <div style="font-size: 0.8em;">Earlier versions? <a href="https://github.com/jeyeager65/FluidTouch/issues" target="_blank" style="color: #00bcd4;">Create an issue</a></div>
                        </div>
                    </div>
                    <a href="https://www.elecrow.com/crowpanel-advance-7-0-hmi-esp32-ai-display-800x480-artificial-intelligent-ips-touch-screen-support-meshtastic-and-arduino-lvgl-micropython.html" 
                       target="_blank" class="product-link">View Product Page ‚Üí</a>
                </div>
            </div>
        </div>

        <!-- Requirements -->
        <div class="requirements">
            <h3>‚ö†Ô∏è Before Installing</h3>
            <ul>
                <li><strong>Browser:</strong> Chrome, Edge, or Opera (required for Web Serial API)</li>
                <li><strong>Cable:</strong> USB-C cable with data support (not charge-only)</li>
                <li><strong>Permissions:</strong> Allow serial port access when prompted</li>
                <li><strong>Important:</strong> Installing wrong hardware firmware will result in non-functional display</li>
            </ul>
        </div>

        <!-- Installation Section -->
        <div class="install-section">
            <h2>üöÄ Install Firmware</h2>
            <div class="hardware-confirm">
                Selected: <strong id="selected-hardware">Elecrow CrowPanel 7" Basic (4MB Flash)</strong>
            </div>
            <esp-web-install-button manifest="./manifest_basic.json" id="install-button">
                <button slot="activate">Install FluidTouch</button>
                <span slot="unsupported">
                    <p style="color: #f44336;">Your browser doesn't support Web Serial API.</p>
                    <p>Please use Chrome, Edge, or Opera browser.</p>
                </span>
                <span slot="not-allowed">
                    <p style="color: #f44336;">Serial port access not allowed.</p>
                    <p>Please check your browser permissions.</p>
                </span>
            </esp-web-install-button>

            <!-- Progress Tracker -->
            <div class="progress-container" id="progress-container">
                <div class="progress-step" id="step-connect">
                    <div class="progress-icon">1</div>
                    <span>Connecting to device...</span>
                </div>
                <div class="progress-step" id="step-erase">
                    <div class="progress-icon">2</div>
                    <span>Erasing flash memory...</span>
                </div>
                <div class="progress-step" id="step-write">
                    <div class="progress-icon">3</div>
                    <span>Writing firmware...</span>
                </div>
                <div class="progress-step" id="step-verify">
                    <div class="progress-icon">4</div>
                    <span>Verifying installation...</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="progress-bar-fill"></div>
                </div>
                <div style="text-align: center; margin-top: 10px; font-size: 0.9em; color: #8b949e;">
                    <span id="progress-percent">0%</span> complete
                </div>
            </div>
        </div>
    </div>

    <script>
        // Hardware selection
        let selectedHardware = 'basic';
        const hardwareNames = {
            'basic': 'Elecrow CrowPanel 7" Basic',
            'advance': 'Elecrow CrowPanel 7" Advance'
        };

        function selectHardware(hardware) {
            selectedHardware = hardware;
            
            // Update card selection
            document.querySelectorAll('.hardware-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`[data-hardware="${hardware}"]`).classList.add('selected');
            
            // Update confirmation text
            document.getElementById('selected-hardware').textContent = hardwareNames[hardware];
            
            // Update manifest path
            const installButton = document.getElementById('install-button');
            if (hardware === 'basic') {
                installButton.setAttribute('manifest', './manifest_basic.json');
            } else {
                installButton.setAttribute('manifest', './manifest_advance.json');
            }
            
            // Save selection to localStorage
            localStorage.setItem('fluidtouch-hardware', hardware);
            
            console.log('Selected hardware:', hardware, '- Manifest updated');
        }

        // Load saved hardware selection
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('fluidtouch-hardware');
            if (saved && (saved === 'basic' || saved === 'advance')) {
                selectHardware(saved);
            }
        });

        // ESP Web Tools event monitoring
        document.querySelector('esp-web-install-button').addEventListener('state-changed', (ev) => {
            const state = ev.detail;
            const progressContainer = document.getElementById('progress-container');

            if (state === 'CONNECTED') {
                progressContainer.style.display = 'block';
            }
        });
    </script>
    </div> <!-- .page-wrapper -->
</body>
</html>
